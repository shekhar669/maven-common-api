name: Release Please

on:
  push:
    branches: [ "main" ]

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: googleapis/release-please-action@v4
        id: release
        with:
          # Use GitHub token for authentication
          token: ${{ secrets.GITHUB_TOKEN }}
      
      # Manual approval step - only runs when releases are created
      - name: Wait for Release Approval
        if: ${{ steps.release.outputs.releases_created }}
        uses: trstringer/manual-approval@v1
        with:
          secret: ${{ secrets.GITHUB_TOKEN }}
          approvers: shekhar669
          minimum-approvals: 1
          issue-title: "Release Approval Required"
          issue-body: |
            ## Release Approval Request
            
            **Releases Created:** ${{ steps.release.outputs.releases_created }}
            
            A new release has been created. Please review the release and approve by commenting **approved** on this issue.
            To deny, comment **denied**.
            
            [View Releases](https://github.com/${{ github.repository }}/releases)
            
            **Release Details:**
            ```json
            ${{ toJSON(steps.release.outputs) }}
            ```
          exclude-workflow-initiator-as-approver: false
